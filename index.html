<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>vibemod — voice changer</title>
<style>
  :root{
    --bg:#070707;
    --card:#0c0c0d;
    --pink:#ff2fa6;
    --muted:#bdbdbd;
    --glass: rgba(255,255,255,0.02);
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#050506);color:var(--muted);-webkit-font-smoothing:antialiased}
  .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:22px;box-sizing:border-box}
  .card{
    width:380px;border-radius:14px;padding:18px;background:linear-gradient(180deg,var(--card),#070708);
    box-shadow:0 12px 40px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.03);
  }
  h1{margin:0;font-size:20px;color:#fff;font-weight:700;text-transform:lowercase}
  p.sub{margin:4px 0 14px;color:#a9a9a9;font-size:12px}
  .row{display:flex;gap:10px;align-items:center;margin-bottom:10px}
  select, button, input[type="range"]{appearance:none;border-radius:10px;padding:10px 12px;background:var(--glass);border:1px solid rgba(255,255,255,0.03);color:var(--muted);outline:none;font-size:13px}
  select{flex:1}
  .btn{cursor:pointer;border:none;padding:10px 12px;border-radius:10px;font-weight:700;text-transform:lowercase}
  .btn-primary{background:linear-gradient(90deg,var(--pink),#ff7ac7);color:#0b0b0b}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
  .slab{background:rgba(255,255,255,0.01);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);font-size:13px}
  label{font-size:11px;color:#9d9d9d;text-transform:lowercase}
  .controls{display:grid;gap:8px}
  .soundboard{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
  .pad{min-width:84px;padding:8px;border-radius:8px;background:#0a0a0a;border:1px solid rgba(255,255,255,0.02);text-align:center;color:var(--muted);cursor:pointer;font-size:13px}
  .pad.playing{box-shadow:0 8px 20px rgba(255,47,166,0.12);border-color:rgba(255,47,166,0.18);color:white}
  .status{margin-top:10px;font-size:12px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.01);text-align:center}
  footer{margin-top:12px;font-size:11px;color:#888;text-align:center}
  .raw{margin-top:8px;padding:10px;height:88px;overflow:auto;border-radius:8px;background:#050506;border:1px solid rgba(255,255,255,0.02);font-size:12px;color:#cfcfcf}
  .muted{opacity:0.7}
  .row .small{font-size:12px;padding:8px 10px}
  .flex1{flex:1}
  /* slider cosmetics */
  input[type="range"]{height:34px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card" role="application" aria-label="vibemod">
    <h1>vibemod</h1>
    <p class="sub">voice changer • simple • sleek</p>

    <div class="controls">
      <div class="row">
        <select id="voiceSelect" aria-label="select voice">
          <option value="">loading voices…</option>
        </select>
        <button id="refresh" class="btn btn-ghost small">refresh</button>
      </div>

      <div class="row">
        <button id="toggle" class="btn btn-primary small flex1">activate</button>
        <button id="bypass" class="btn btn-ghost small">bypass</button>
      </div>

      <div class="row">
        <div style="flex:1">
          <label>pitch</label>
          <input id="pitch" type="range" min="-12" max="12" value="0" step="0.1" />
        </div>
        <div style="width:10px"></div>
        <div style="flex:1">
          <label>volume</label>
          <input id="volume" type="range" min="0" max="200" value="100" step="1" />
        </div>
      </div>

      <div>
        <label>soundboard</label>
        <div id="soundboard" class="soundboard slab muted">loading…</div>
      </div>

      <div class="row">
        <div class="status" id="status">ws: disconnected</div>
      </div>

      <div class="raw" id="raw">raw messages will appear here (debug)</div>

      <footer class="muted">lowercase • pink & black • embed clientKey (insecure) — docs: control-api.voicemod.net</footer>
    </div>
  </div>
</div>

<script>
/*
  vibemod single-file client
  - connects to Voicemod Control API over WebSocket (wss://control-api.voicemod.net/)
  - authenticates with clientKey below
  - requests voice list, populates UI
  - sends pitch/volume/activate messages
  IMPORTANT: If Voicemod expects different "type" strings or payload shapes, update the send(...) calls
  to match the docs. Incoming messages are appended to the "raw" debug area so you can adapt quickly.
*/

/* ---------- CONFIG (your clientKey) ---------- */
const CLIENT_KEY = "controlapi-bqao9iozL"; // ← your provided clientKey (you supplied this)
const WS_URL = "wss://control-api.voicemod.net/"; // control api websocket base

/* ---------- UI refs ---------- */
const statusEl = document.getElementById('status');
const rawEl = document.getElementById('raw');
const voiceSelect = document.getElementById('voiceSelect');
const refreshBtn = document.getElementById('refresh');
const toggleBtn = document.getElementById('toggle');
const bypassBtn = document.getElementById('bypass');
const pitchSlider = document.getElementById('pitch');
const volumeSlider = document.getElementById('volume');
const soundboardEl = document.getElementById('soundboard');

let ws;
let connected = false;
let active = false;
let voices = [];
let memes = [];

/* small helper to append debug text */
function logRaw(label, obj){
  const t = document.createElement('div');
  const ts = new Date().toLocaleTimeString();
  t.textContent = `[${ts}] ${label}: ${typeof obj === 'string' ? obj : JSON.stringify(obj)}`;
  rawEl.prepend(t);
}

/* connection + basic protocol (best-effort) */
function connect(){
  setStatus('connecting…');
  try{
    ws = new WebSocket(WS_URL);
  }catch(e){
    setStatus('ws error');
    logRaw('error', String(e));
    return;
  }

  ws.addEventListener('open', ()=>{
    connected = true;
    setStatus('connected — authenticating');
    // try authenticate (many websockets for control APIs accept an auth message)
    const authMsg = {
      type: "authenticate",
      payload: {
        clientKey: CLIENT_KEY
      }
    };
    sendRaw(authMsg);
    // also attempt alternative auth forms (some offerings accept "auth" field or query) if needed:
    // If the server expects query param (?clientKey=...) that must be added to WS_URL prior to connect.
  });

  ws.addEventListener('message', (ev)=>{
    let data = ev.data;
    try { data = JSON.parse(ev.data); } catch(e){}
    logRaw('recv', data);
    // attempt to detect auth success
    if(data && (data.type === 'auth_ok' || data.type === 'authenticated' || (data.event && data.event === 'auth_ok'))){
      setStatus('authenticated — loading voices');
      requestVoices();
    }
    // some servers reply with a 'voices' payload
    if(data && (data.type === 'voices' || data.type === 'listVoices' || data.event === 'voices_list')){
      voices = data.payload || data.voices || data.items || [];
      populateVoices();
    }
    // memes / soundboard
    if(data && (data.type === 'memes' || data.type === 'soundboard' || data.event === 'memes_list')){
      memes = data.payload || data.memes || [];
      populateSoundboard();
    }
  });

  ws.addEventListener('close', ()=>{
    connected = false;
    active = false;
    setStatus('disconnected — reconnecting in 2s');
    logRaw('ws', 'closed — retrying');
    setTimeout(connect, 2000);
  });

  ws.addEventListener('error', (e)=>{
    logRaw('ws-error', String(e));
    setStatus('ws error');
  });
}

/* wrappers */
function sendRaw(obj){
  try{
    const s = JSON.stringify(obj);
    if(ws && ws.readyState === WebSocket.OPEN){
      ws.send(s);
      logRaw('send', obj);
    }else{
      logRaw('send-fail', obj);
    }
  }catch(e){
    logRaw('send-err', String(e));
  }
}

/* request voices — many control APIs have a simple command name; try a few likely names */
function requestVoices(){
  // try a few variants (safe best-effort)
  sendRaw({type:'listVoices'});
  sendRaw({type:'getVoices'});
  sendRaw({type:'voices'});
  sendRaw({type:'get_voices'});
  // also request soundboard
  sendRaw({type:'listMemes'});
  sendRaw({type:'getMemes'});
}

/* populate UI from voices[] (best-effort mapping) */
function populateVoices(){
  voiceSelect.innerHTML = '';
  if(!voices || voices.length === 0){
    voiceSelect.innerHTML = '<option value="">no voices found</option>';
    return;
  }
  const blank = document.createElement('option'); blank.value=''; blank.textContent='choose voice';
  voiceSelect.appendChild(blank);
  voices.forEach(v=>{
    // try multiple common property names for id and friendly name
    const id = v.id || v.key || v.name || v.voiceId || JSON.stringify(v);
    const name = (v.name || v.friendlyName || v.displayName || v.title || id).toString().toLowerCase();
    const opt = document.createElement('option');
    opt.value = id;
    opt.textContent = name;
    voiceSelect.appendChild(opt);
  });
}

/* soundboard */
function populateSoundboard(){
  soundboardEl.innerHTML = '';
  if(!memes || memes.length === 0){
    soundboardEl.innerHTML = '<div class="muted">no sounds</div>';
    return;
  }
  memes.forEach(m=>{
    const id = m.id || m.key || m.name;
    const name = (m.name || m.title || id).toString().toLowerCase();
    const pad = document.createElement('div');
    pad.className='pad';
    pad.textContent = name;
    pad.onclick = async ()=>{
      pad.classList.add('playing');
      sendPlayMeme(id);
      setTimeout(()=>pad.classList.remove('playing'), 900);
    };
    soundboardEl.appendChild(pad);
  });
}

/* commands */
function setVoice(voiceId){
  // example control messages — update if your docs use different names
  sendRaw({type:'selectVoice', payload:{voiceId}});
  // also try alternative messages:
  sendRaw({type:'setVoice', payload:{voice: voiceId}});
  sendRaw({type:'voice.set', payload:{id: voiceId}});
}
function setPitch(p){
  sendRaw({type:'setPitch', payload:{value: Number(p)}});
  sendRaw({type:'pitch', payload:{value: Number(p)}});
}
function setVolume(v){
  sendRaw({type:'setVolume', payload:{value: Number(v)}});
  sendRaw({type:'volume', payload:{value: Number(v)}});
}
function toggleActive(enable){
  if(enable){
    sendRaw({type:'activateVoice'});
    sendRaw({type:'voice.on'});
  } else {
    sendRaw({type:'deactivateVoice'});
    sendRaw({type:'voice.off'});
  }
}
function sendPlayMeme(memeId){
  sendRaw({type:'playMeme', payload:{memeId}});
  sendRaw({type:'play_sound', payload:{id:memeId}});
}

/* UI handlers */
refreshBtn.onclick = ()=> requestVoices();

voiceSelect.addEventListener('change', ()=>{
  const v = voiceSelect.value;
  if(!v) return;
  setVoice(v);
});

toggleBtn.addEventListener('click', ()=>{
  active = !active;
  toggleBtn.textContent = active ? 'deactivate' : 'activate';
  toggleActive(active);
});

bypassBtn.addEventListener('click', ()=>{
  // Try to toggle bypass / hear-myself
  sendRaw({type:'toggleBypass'});
  sendRaw({type:'bypass'});
});

pitchSlider.addEventListener('input', (e)=>{
  const val = e.target.value;
  setPitch(val);
});

volumeSlider.addEventListener('input', (e)=>{
  setVolume(e.target.value);
});

/* status helper */
function setStatus(t){
  statusEl.textContent = 'ws: ' + t;
}

/* initialize */
setStatus('idle');
connect();
</script>
</body>
</html>
